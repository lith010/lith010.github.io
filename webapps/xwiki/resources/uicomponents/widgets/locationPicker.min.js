/*
 #set ($l10nKeys = [
  'entitynamevalidation.nametransformation.error',
  'core.validation.valid.message',
  'core.validation.required.message',
  'core.validation.required.message.terminal'
])
#set ($l10n = {})
#foreach ($key in $l10nKeys)
  #set ($discard = $l10n.put($key, $services.localization.render($key)))
#end
#[[*/
'use strict';(function(w){require(["xwiki-tree"],function(h){h(".location-picker").each(function(){var q=h(this),n=q.find(".location-action-pick"),f=q.find(".modal"),p=f.find(".location-tree"),e=f.find(".modal-footer .btn-primary");n.on("click",function(b){b.preventDefault();f.modal()});f.on("shown.bs.modal",function(b){var a=n.attr("data-openTo");a&&a!==f.data("openTo")?f.data("openTo",a):a=!1;b=h.jstree.reference(p);if(b)a&&(b.deselect_all(),b.close_all(),b.openTo(a));else p.xtree({core:{multiple:"true"===
p.data("multiple")}}).one("ready.jstree",function(c,d){a&&d.instance.openTo(a)}).on("changed.jstree",function(c,d){e.prop("disabled",!d.selected.length)}).on("dblclick",".jstree-anchor",function(){e.click()})});e.on("click",function(){f.modal("hide");f.triggerHandler("xwiki:locationTreePicker:select",{tree:h.jstree.reference(p)})})})});require(["jquery","xwiki-meta"],function(h,q){h(".location-picker").each(function(){var n=h(this),f=n.find(".location-wiki-field"),p=n.find("input.location-parent-field");
n.find(".location-action-pick").on("click",function(e){e=f.val()||q.wiki;var b="wiki:"+e;p.val()&&(e=XWiki.Model.resolve(p.val(),XWiki.EntityType.SPACE,[e]),e=new XWiki.EntityReference("WebHome",XWiki.EntityType.DOCUMENT,e),b="document:"+XWiki.Model.serialize(e));h(this).attr("data-openTo",b)});n.find(".modal").on("xwiki:locationTreePicker:select",function(e,b){b=b.tree.get_selected()[0];var a=b.indexOf(":");e=b.substr(0,a);b=b.substr(a+1);b=XWiki.Model.resolve(b,XWiki.EntityType.byName(e));e=b.extractReference(XWiki.EntityType.WIKI);
f.val(e?e.name:"");e=(b=b.extractReference(XWiki.EntityType.SPACE))?XWiki.Model.serialize(b.relativeTo(e)):"";p.val(e);p.triggerHandler("input")})})});require(["jquery","xwiki-meta","xwiki-events-bridge","xwiki-form-validation-async"],function(h,q){h(".location-picker").each(function(){var n=h(this);n.closest("form");var f=n.find("input.location-title-field"),p=n.find(".location-wiki-field"),e=n.find("input.location-parent-field"),b=n.find("input.location-name-field"),a=n.find(".breadcrumb"),c=function(k){if(b.prop("readonly"))return Promise.resolve({transformedName:b.val()});
var l=XWiki.currentDocument.getURL("get");return Promise.resolve(h.get(l,{xpage:"entitynamevalidation_json",outputSyntax:"plain",name:k,form_token:q.form_token}))},d=function(k){var l=a.children(".preview");0===l.length&&(l=h(document.createElement("li")).addClass("preview active").appendTo(a));l.text(k)},m=function(k){b.prop("disabled",!0);"input"===k?.type?f.validateAsync(g,500,"locationPicker"):f.validateAsync(g(),"locationPicker")},g=function(){var k=f.val();return c(k).then(l=>{k===f.val()&&
(b.prop("disabled",!1).val(l.transformedName).trigger("change"),d(f.val()))}).catch(()=>{k===f.val()&&(new XWiki.widgets.Notification(w["entitynamevalidation.nametransformation.error"],"error"),b.prop("disabled",!1).val(k).trigger("change"),d(f.val()))})},r=function(k,l){var u=l?l.value:e.val();a.validateAsync(()=>v(p.val(),u),500,"locationPicker")},v=function(k,l){k=k||p.val();l=l||e.val();var u=XWiki.Model.resolve(l||q.space,XWiki.EntityType.SPACE),y=new XWiki.EntityReference("WebHome",XWiki.EntityType.DOCUMENT,
u);k&&u.appendParent(new XWiki.WikiReference(k));return h.post(x(),{xpage:"hierarchy_reference",reference:XWiki.Model.serialize(y)},function(t){t=h(t);t.attr("id",a.attr("id"));a.replaceWith(t);a=t;l||a.find("li").not(".wiki").remove();a.find(".active").removeClass("active");t=f.val();d(t?t:b.val())})},x=function(){var k=XWiki.Model.resolve(q.space,XWiki.EntityType.SPACE).getReversedReferenceChain().map(function(u){return encodeURIComponent(u.name)}).join("/"),l=XWiki.Document.URLTemplate;l=l.replace("__space__",
k);l=l.replace("__page__",q.page);return l=l.replace("__action__","get")};f.on("input change",m);p.on("change",function(k){a.validateAsync(v,"locationPicker")});b.on("input change",function(k){f.val()||d(b.val())});e.on("input change xwiki:suggest:selected",r);e.val()||r();void 0!==b.val()&&!b.val()&&f.val()?m():d(f.val());var z=n.find(".location-edit");n.find(".location-action-edit").on("click",function(k){k.preventDefault();z.toggleClass("hidden")})})});require(["jquery"],function(h){var q=function(a){return 0<
a.find(".location-actions").length&&0==a.find(".location-action-edit").length},n=function(a){var c=a.find("input.location-name-field");if(0===c.length)return null;var d=a.find("input.location-title-field");a=0<d.length&&q(a);var m=new LiveValidation(c[0],{validMessage:w["core.validation.valid.message"],insertAfterWhatNode:a?d[0]:c[0]});m.displayMessageWhenEmpty=!0;m.add(Validate.Custom,{failureMessage:w["core.validation.required.message"],against:function(g){return"string"===typeof g&&0<g.strip().length}});
c.on("change",function(){m.validate()});return m},f=function(a){var c=a.find("input.location-parent-field");if(0<c.length){var d=a.find(".breadcrumb-container");a=0<d.length&&q(a);c=new LiveValidation(c[0],{validMessage:w["core.validation.valid.message"],onlyOnBlur:!0,insertAfterWhatNode:a?d[0]:c[0]});c.displayMessageWhenEmpty=!0;return c}return null},p=function(a,c,d){a._customValuesParams&&(a.remove(Validate.Custom,a._customValuesParams),delete a._customValuesParams);0<c.length&&(a._customValuesParams=
{failureMessage:d,against:function(m){for(var g=0;g<c.length;g++){var r=c[g];if(r===m||0===m.indexOf(r+"."))return!0}return!1}},a.add(Validate.Custom,a._customValuesParams))},e=function(a,c){a.add(Validate.Custom,{failureMessage:w["core.validation.required.message.terminal"],against:function(d){return c.prop("checked")?"string"===typeof d&&0<d.strip().length:!0}});c.on("change",function(){a.validate()})},b=function(a,c){a.on("change",function(){a.prop("checked")&&c.prop("checked",!1)});c.on("change",
function(){c.prop("checked")&&a.prop("checked",!1)})};h(".location-picker").each(function(){var a=h(this),c=[],d=f(a);d&&(c.push(d),a.data("spaceValidator",d));var m=n(a);m&&(c.push(m),a.data("pageValidator",m));var g=a.find(".location-edit"),r=a.find(".location-action-edit");a.closest("form").on("submit",function(v){!LiveValidation.massValidate(c)&&g.hasClass("hidden")&&setTimeout(()=>r.click(),0)});a.find("input.location-parent-field").on("input",function(){d.validate()})});h("form#create").each(function(){var a=
h(this),c=a.find(".location-picker").data("spaceValidator");e(c,a.find("#terminal"));var d=function(g){var r="true"==g.attr("data-restrictions-are-suggestions"),v=[],x=g.attr("data-allowed-spaces");!r&&x&&(v=JSON.parse(g.attr("data-allowed-spaces")));g=g.attr("data-allowed-spaces-message");p(c,v,g)};a.find(".xwiki-select").on("xwiki:select:updated",function(g){g=h('input[name="type"]:checked');d(g);c.validate()});var m=a.find('input[name="templateprovider"]');0==m.length&&(m=a.find('.xwiki-select input[name="type"]:checked'));
d(m)});h("form#copy, form#rename").each(function(){var a=h(this),c=a.find(".location-picker").data("spaceValidator"),d=a.find('input[name="terminal"]'),m=a.find('input[name="deep"]'),g=a.find('select[name="language"]');e(c,d);b(m,d);g.on("change",function(){"ALL"===g.val()?m.prop("disabled",!1):m.prop({checked:!1,disabled:!0})})})})}).apply("]]#",$jsontool.serialize([$l10n]));
//# sourceMappingURL=locationPicker.min.js.map
