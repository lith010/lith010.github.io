/*
 #set ($l10nKeys = [
  'core.viewers.attachments.upload.addFileInput',
  'core.viewers.attachments.upload.removeFileInput',
  'core.viewers.attachments.upload.removeFileInput.title',
  'core.viewers.attachments.delete.inProgress',
  'core.viewers.attachments.delete.done',
  'core.viewers.attachments.delete.failed',
  ['docextra.extranb', '__number__'],
  'docextra.attachments'
])
#set ($l10n = {})
#foreach ($key in $l10nKeys)
  #set ($params = $key.subList(1, $key.size()))
  #if ($params)
    #set ($discard = $l10n.put($key[0], $services.localization.render($key[0], $params)))
  #else
    #set ($discard = $l10n.put($key, $services.localization.render($key)))
  #end
#end
#[[*/
'use strict';(function(e){window.XWiki=window.XWiki||{};var h=XWiki.viewers=XWiki.viewers||{};h.Attachments=Class.create({counter:1,initialize:function(){this.addTabLoadListener();this.prepareForm()},prepareForm:function(){if($("attachform")){this.form=$("attachform").up("form");this.defaultFileDiv=this.form.down("input[type='file']").up("div");this.inputSize=this.form.down("input[type='file']").size;var a=this.attachHTML5Uploader(this.form.down("input[type='file']"));a?a.hideFormButtons():(this.addInitialRemoveButton(),
this.addAddButton(),this.resetOnCancel());this.blockEmptySubmit()}},attachHTML5Uploader:function(a){return"undefined"!=typeof XWiki.FileUploader?(a.multiple=!0,new XWiki.FileUploader(a,{responseContainer:document.createElement("div"),responseURL:"",maxFilesize:parseInt(a.readAttribute("data-max-file-size"))})):!1},addInitialRemoveButton:function(){this.defaultFileDiv.appendChild(this.createRemoveButton())},addAddButton:function(){var a=new Element("input",{type:"button",value:e["core.viewers.attachments.upload.addFileInput"],
className:"attachmentActionButton add-file-input"});this.addDiv=new Element("div");this.addDiv.appendChild(a);Event.observe(a,"click",this.addField.bindAsEventListener(this));this.defaultFileDiv.up().insertBefore(this.addDiv,this.defaultFileDiv.next())},blockEmptySubmit:function(){Event.observe(this.form,"submit",this.onSubmit.bindAsEventListener(this))},resetOnCancel:function(){Event.observe(this.form,"reset",this.onReset.bindAsEventListener(this));Event.observe(this.form.down(".cancel"),"click",
this.onReset.bindAsEventListener(this))},addField:function(a){var d=new Element("input",{type:"file",name:"filepath_"+this.counter,size:this.inputSize,className:"uploadFileInput"}),g=new Element("input",{type:"hidden",name:"filename_"+this.counter}),c=this.createRemoveButton(),b=new Element("div",{"class":"fileupload-field"});b.insert(g).insert(d).insert(c);this.addDiv.parentNode.insertBefore(b,this.addDiv);a.element().blur();this.counter++},removeField:function(a){a.element().up("div").remove()},
createRemoveButton:function(){var a=new Element("input",{type:"button",value:e["core.viewers.attachments.upload.removeFileInput"],title:e["core.viewers.attachments.upload.removeFileInput.title"],className:"attachmentActionButton remove-file-input"});Event.observe(a,"click",this.removeField.bindAsEventListener(this));return a},onSubmit:function(a){var d=!1;this.form.getInputs("file").each(function(g){""!=g.value&&(d=!0)});d||a.stop()},onReset:function(a){a&&a.stop();this.form.getInputs("file").each(function(d){d.up().remove()});
this.counter=1;this.addField(a)},addTabLoadListener:function(a){a=function(d){"Attachments"==d.memo.id&&this.prepareForm()}.bindAsEventListener(this);document.observe("xwiki:docextra:loaded",a)}});XWiki.domIsLoaded&&new h.Attachments||document.observe("xwiki:dom:loaded",function(){new h.Attachments});require(["jquery","xwiki-events-bridge"],function(a){a(document).on("click",".deleteAttachment input.btn-danger",function(c){c.preventDefault();c=a(c.currentTarget).closest(".deleteAttachment");var b=
a(c.data("relatedTarget")),f=b.closest(".liveData").data("liveData"),k;a.ajax({url:b.prop("href"),beforeSend:function(){b.prop("disabled",!0);k=new XWiki.widgets.Notification(e["core.viewers.attachments.delete.inProgress"],"inprogress")},success:function(){f.updateEntries().then(()=>{"docAttachments"===f.data.id&&d(f.data.data.count)});k.replace(new XWiki.widgets.Notification(e["core.viewers.attachments.delete.done"],"done"))},error:function(){b.prop("disabled",!1);k.replace(new XWiki.widgets.Notification(e["core.viewers.attachments.delete.failed"],
"error"))}})});a(document).on("click",".attachmentActions .actiondelete",function(c){c.preventDefault();var b=a(c.currentTarget).closest(".liveData").next(".deleteAttachment");b.data("relatedTarget",c.currentTarget);b.modal("show")});var d=function(c){c&&0<=c?g(c):a.ajax({url:XWiki.currentDocument.getURL("get","xpage=xpart&vm=attachmentsjson.vm"),success:function(b){g(b.totalrows)}})},g=function(c){var b=a("#Attachmentstab").find(".itemCount");b&&b.text(e["docextra.extranb"].replace("__number__",
c));b=a("#tmAttachments");if(b.length){b[0].normalize();var f=" "+e["docextra.attachments"]+" "+e["docextra.extranb"];f=f.replace("__number__",c);b.contents().last()[0].nodeValue=f}};a(document).on("xwiki:html5upload:done",function(){a("#docAttachments").data("liveData").updateEntries().then(()=>{d(a("#docAttachments").data("liveData").data.data.count)})});a(document).on("xwiki:docextra:loaded",function(c,b){"Attachments"===b.id&&d()})})}).apply("]]#",$jsontool.serialize([$l10n]));
//# sourceMappingURL=attachments.min.js.map
