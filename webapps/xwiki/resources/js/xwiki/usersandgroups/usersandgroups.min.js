'use strict';define("users-and-groups-translation-keys",{prefix:"platform.core.rightsManagement.",keys:["allowed","denied","undefined"]});
window.MSCheckbox=Class.create({initialize:function(a,f,e,c,b,d){this.table=b;this.idx=d;this.table&&this.idx&&this.table.fetchedRows[this.idx]?(this.currentUorG=this.table.fetchedRows[this.idx].fullname,this.isUserInGroup=this.table.fetchedRows[this.idx].isuseringroup):(this.currentUorG=window.unregUser,this.isUserInGroup=!1);this.right=f;this.saveUrl=e;this.state=this.defaultState=c;this.states=[0,1,2];this.nrstates=this.states.length;this.images=["$xwiki.getSkinFile('js/xwiki/usersandgroups/img/none.png')",
"$xwiki.getSkinFile('js/xwiki/usersandgroups/img/allow.png')","$xwiki.getSkinFile('js/xwiki/usersandgroups/img/deny1.png')"];this.button=document.createElement("button");this.button.className="rights-edit";this.button.addEventListener("click",this.createClickHandler(this));f=document.createElement("img");this.button.appendChild(f);$(a).appendChild(this.button);this.draw(this.state)},draw:function(a){var f=this.button.firstChild;f.src=this.images[a];var e=this.button;require(["xwiki-l10n!users-and-groups-translation-keys"],
function(c){c=[c.undefined,c.allowed,c.denied];f.alt=c[a];e.title=c[a]})},nextState:function(){return(this.state+1)%this.nrstates},next:function(){this.state=this.nextState();void 0!=this.table&&delete this.table.fetchedRows[this.idx];this.draw(this.state)},createClickHandler:function(a){return function(f){f.preventDefault();if(!a.req){f="";var e=(a.state+1)%a.nrstates;if(a.currentUorG==window.currentUser)if(2==e){var c="$escapetool.javascript($services.localization.render('rightsmanager.denyrightforcurrentuser'))".replace("__right__",
a.right);if(!confirm(c))if(c="$escapetool.javascript($services.localization.render('rightsmanager.clearrightforcurrentuserinstead'))".replace("__right__",a.right),confirm(c))f="clear",a.state=2,e=0;else return}else{if(0==e&&(c="$escapetool.javascript($services.localization.render('rightsmanager.clearrightforcurrentuser'))".replace("__right__",a.right),!confirm(c)))return}else if(a.isUserInGroup||"XWiki.XWikiGuest"==window.currentUser&&"XWiki.XWikiAllGroup"==a.currentUorG)if(2==e){if(c="$escapetool.javascript($services.localization.render('rightsmanager.denyrightforgroup'))".replace(/__right__/g,
a.right),c=c.replace("__name__",a.currentUorG),!confirm(c))if(c="$escapetool.javascript($services.localization.render('rightsmanager.clearrightforgroupinstead'))".replace(/__right__/g,a.right),c=c.replace("__name__",a.currentUorG),confirm(c))f="clear",a.state=2,e=0;else return}else{if(0==e&&(c="$escapetool.javascript($services.localization.render('rightsmanager.clearrightforgroup'))".replace(/__right__/g,a.right),c=c.replace("__name__",a.currentUorG),!confirm(c)))return}else if("admin"==a.right)if(2==
e){if(c="$escapetool.javascript($services.localization.render('rightsmanager.denyrightforuorg'))".replace("__right__",a.right),c=c.replace("__name__",a.currentUorG),!confirm(c))return}else if(0==e&&(c="$escapetool.javascript($services.localization.render('rightsmanager.clearrightforuorg'))".replace("__right__",a.right),c=c.replace("__name__",a.currentUorG),!confirm(c)))return;""==f&&(f=0==e?"clear":1==e?"allow":"deny");a.req=new Ajax.Request(a.saveUrl+"&action="+f+"&right="+a.right,{method:"get",
onSuccess:function(b){"SUCCESS"==b.responseText.strip()?a.next():(alert("$services.localization.render('platform.core.rightsManagement.saveFailure')"),b=unescape(window.location.pathname),window.location.href=b)},onFailure:function(){alert("$services.localization.render('platform.core.rightsManagement.ajaxFailure')")},onComplete:function(){delete a.req}})}}}});
function displayUsers(a,f,e,c){var b=a.userurl,d=a.usersaveurl,h=a.userinlineurl,g=a.wikiname,n=a.docurl,l=document.createElement("tr"),k=document.createElement("td");k.setAttribute("data-title","$escapetool.javascript($services.localization.render('xe.admin.users.username'))");if("local"==g){var m=document.createElement("a");m.href=b;m.appendChild(document.createTextNode(a.username));k.appendChild(m)}else k.appendChild(document.createTextNode(a.username));k.className="username";l.appendChild(k);
b=document.createElement("td");b.setAttribute("data-title","$escapetool.javascript($services.localization.render('xe.admin.users.firstname'))");b.appendChild(document.createTextNode(a.firstname));l.appendChild(b);b=document.createElement("td");b.setAttribute("data-title","$escapetool.javascript($services.localization.render('xe.admin.users.lastname'))");b.appendChild(document.createTextNode(a.lastname));l.appendChild(b);b=document.createElement("td");b.setAttribute("data-title","$escapetool.javascript($services.localization.render('xe.admin.users.manage'))");
b.className="manage";"local"==g&&(g=document.createElement("img"),g.src='$xwiki.getSkinFile("js/xwiki/usersandgroups/img/edit.png")',g.title="$services.localization.render('edit')",Event.observe(g,"click",editUserOrGroup(h,d,n)),g.className="icon-manage",b.appendChild(g),d=document.createElement("img"),"true"==a.grayed?(d.src='$xwiki.getSkinFile("js/xwiki/usersandgroups/img/clearg.png")',d.className="icon-manageg"):(d.src='$xwiki.getSkinFile("js/xwiki/usersandgroups/img/clear.png")',Event.observe(d,
"click",deleteUserOrGroup(f,e,a.fullname,"user",c)),d.className="icon-manage"),d.title="$services.localization.render('delete')",b.appendChild(d));l.appendChild(b);return l}
function displayGroups(a,f,e,c){var b=a.userurl,d=a.userinlineurl,h=a.usersaveurl,g=a.wikiname,n=a.docurl,l=document.createElement("tr"),k=document.createElement("td");k.setAttribute("data-title","$escapetool.javascript($services.localization.render('xe.admin.groups.groupname'))");if("local"==g){var m=document.createElement("a");m.href=b;m.appendChild(document.createTextNode(a.username));k.appendChild(m)}else k.appendChild(document.createTextNode(a.username));k.className="username";l.appendChild(k);
b=document.createElement("td");b.setAttribute("data-title","$escapetool.javascript($services.localization.render('xe.admin.groups.members'))");"local"==g?b.appendChild(document.createTextNode(a.members)):b.appendChild(document.createTextNode("-"));l.appendChild(b);b=document.createElement("td");b.setAttribute("data-title","$escapetool.javascript($services.localization.render('xe.admin.groups.manage'))");b.className="manage";"local"==g&&(g=document.createElement("img"),g.src='$xwiki.getSkinFile("js/xwiki/usersandgroups/img/clear.png")',
g.title="$services.localization.render('delete')",Event.observe(g,"click",deleteUserOrGroup(f,e,a.fullname,"group",c)),g.className="icon-manage",a=document.createElement("img"),a.src='$xwiki.getSkinFile("js/xwiki/usersandgroups/img/edit.png")',a.title="$services.localization.render('edit')",Event.observe(a,"click",editUserOrGroup(d,h,n)),a.className="icon-manage",b.appendChild(a),b.appendChild(g));l.appendChild(b);return l}
function displayMembers(a,f,e,c){var b=document.createElement("tr"),d=document.createElement("td"),h=document.createTextNode(a.prettyname);if("local"==a.wikiname){var g=document.createElement("a");g.href=a.memberurl;g.appendChild(h);d.appendChild(g)}else d.appendChild(h);d.className="username";b.appendChild(d);"inline"==e.action&&(d=document.createElement("td"),d.className="manage",h=document.createElement("img"),"true"==a.grayed?(h.src='$xwiki.getSkinFile("js/xwiki/usersandgroups/img/clearg.png")',
h.className="icon-manageg"):(h.src='$xwiki.getSkinFile("js/xwiki/usersandgroups/img/clear.png")',Event.observe(h,"click",deleteMember(f,e,a.fullname,a.docurl,c)),h.className="icon-manage"),h.title="$services.localization.render('delete')",d.appendChild(h),b.appendChild(d));return b}
function displayUsersAndGroups(a,f,e,c,b,d){c=e.json.uorg;var h=a.allows.map(m=>m.toLowerCase()),g=a.denys.map(m=>m.toLowerCase());void 0===d&&(d=XWiki.currentDocument);var n=d.getURL("view","xpage=saverights&clsname="+e.json.clsname+"&fullname="+encodeURIComponent(a.fullname)+"&uorg="+c);void 0!=b&&(n+="&form_token="+b);var l=document.createElement("tr");b=document.createElement("td");"groups"==c?b.setAttribute("data-title","$escapetool.javascript($services.localization.render('rightsmanager.groupname'))"):
b.setAttribute("data-title","$escapetool.javascript($services.localization.render('rightsmanager.username'))");b.innerHTML=a.userDisplayer;var k=[];a=e.displayNode.parentElement.getElementsByTagName("th");for(d=1;d<a.length;d++)k[d-1]=a[d].textContent;b.className="username";l.appendChild(b);window.activeRights.forEach(function(m,p){if(m){var q=document.createElement("td");q.className="rights";q.setAttribute("data-title",k[p]);p=0;0<=g.indexOf(m)?p=2:0<=h.indexOf(m)&&(p=1);new MSCheckbox(q,m,n,p,e,
f);l.appendChild(q)}});return l}function deleteUserOrGroup(a,f,e,c,b){return function(){var d="$escapetool.javascript($services.localization.render('rightsmanager.confirmdeletegroup'))";"user"==c&&(d="$escapetool.javascript($services.localization.render('rightsmanager.confirmdeleteuser'))");confirm(d.replace("__name__",e))&&new Ajax.Request("",{method:"get",parameters:{xpage:"deleteuorg",docname:e,form_token:b},onSuccess:function(h){f.deleteRow(a)}})}}
function deleteMember(a,f,e,c,b){return function(){var d=c+"?xpage=deletegroupmember&fullname="+e;void 0!=b&&(d+="&form_token="+b);confirm("$escapetool.javascript($services.localization.render('rightsmanager.confirmdeletemember'))")&&new Ajax.Request(d,{method:"get",onSuccess:function(h){f.deleteRow(a)}})}}
function setBooleanPropertyFromLiveCheckbox(a,f,e,c){return function(){var b="$xwiki.getURL('XWiki.XWikiPreferences', 'save')",d="XWiki.XWikiPreferences",h="0";void 0!=f&&0<f.length&&(b=f);void 0!=e&&0<e.length&&(d=e);void 0!=c&&(h=c);var g="yes",n="$xwiki.getSkinFile('js/xwiki/usersandgroups/img/allow-black.png')",l="1";"yes"==a.getAttribute("alt")&&(g="no",n="$xwiki.getSkinFile('js/xwiki/usersandgroups/img/none.png')",l="0");var k={parameters:{}};k.parameters[d+"_"+h+"_"+a.id]=l;k.parameters.ajax=
"1";k.parameters.comment="$services.localization.render('authenticate_viewedit_savecomment')";k.onSuccess=function(){a.alt=g;a.src=n};new Ajax.Request(b,k)}}
function setGuestExtendedRights(a){return function(){"yes"==a.getAttribute("alt")?0<a.id.indexOf("view")?new Ajax.Request('$xwiki.getURL("XWiki.XWikiPreferences", "save")',{method:"post",parameters:{"XWiki.XWikiPreferences_0_authenticate_view":"0"},onSuccess:function(){a.alt="no";a.src="$xwiki.getSkinFile('js/xwiki/usersandgroups/img/none.png')"}}):new Ajax.Request('$xwiki.getURL("XWiki.XWikiPreferences", "save")',{method:"post",parameters:{"XWiki.XWikiPreferences_0_authenticate_edit":"0"},onSuccess:function(){a.alt=
"no";a.src="$xwiki.getSkinFile('js/xwiki/usersandgroups/img/none.png')"}}):0<a.id.indexOf("view")?new Ajax.Request('$xwiki.getURL("XWiki.XWikiPreferences", "save")',{method:"post",parameters:{"XWiki.XWikiPreferences_0_authenticate_view":"1"},onSuccess:function(){a.alt="yes";a.src="$xwiki.getSkinFile('js/xwiki/usersandgroups/img/allow-black.png')"}}):new Ajax.Request('$xwiki.getURL("XWiki.XWikiPreferences", "save")',{method:"post",parameters:{"XWiki.XWikiPreferences_0_authenticate_edit":"1"},onSuccess:function(){a.alt=
"yes";a.src="$xwiki.getSkinFile('js/xwiki/usersandgroups/img/allow-black.png')"}})}};
//# sourceMappingURL=usersandgroups.min.js.map
